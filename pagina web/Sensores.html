<script>
    // Alternar entre gráficos
    const tabs = document.querySelectorAll('.tabs button');
    const charts = document.querySelectorAll('.chart-container');

    tabs.forEach(tab => {
        tab.addEventListener('click', () => {
            tabs.forEach(t => t.classList.remove('active'));
            charts.forEach(chart => chart.classList.remove('active'));
            tab.classList.add('active');
            document.getElementById(tab.dataset.tab).classList.add('active');
        });
    });

    function createChart(canvasId, yAxisLabel) {
        const ctx = document.getElementById(canvasId).getContext('2d');
        return new Chart(ctx, {
            type: 'line',
            data: {
                labels: Array(20).fill(''),
                datasets: [
                    { label: 'Eixo X', data: Array(20).fill(null), borderColor: 'rgb(255, 99, 132)', borderWidth: 2 },
                    { label: 'Eixo Y', data: Array(20).fill(null), borderColor: 'rgb(54, 162, 235)', borderWidth: 2 },
                    { label: 'Eixo Z', data: Array(20).fill(null), borderColor: 'rgb(75, 192, 192)', borderWidth: 2 }
                ]
            },
            options: {
                responsive: true,
                animation: false,
                scales: {
                    y: { beginAtZero: true, title: { display: true, text: yAxisLabel } }
                }
            }
        });
    }

    const accelerometerChart = createChart('accelerometerChart', 'm/s²');
    const gyroscopeChart = createChart('gyroscopeChart', 'rad/s');
    const compassChart = createChart('compassChart', 'graus');

    const statusEl = document.getElementById('connectionStatus');
    let ws;

    // Função para atualizar o título do gráfico com valores simplificados
    function updateChartTitle(sensor, x, y, z) {
        const chartContainer = document.getElementById(sensor.toLowerCase());
        const titleEl = chartContainer.querySelector('h2');

        // Atualizar o título com os valores formatados
        const formattedX = x.toFixed(2);
        const formattedY = y.toFixed(2);
        const formattedZ = z.toFixed(2);

        titleEl.textContent = `${sensor} (X: ${formattedX}, Y: ${formattedY}, Z: ${formattedZ})`;
    }

    function connectWebSocket() {
        ws = new WebSocket('wss://20.241.18.98:3001'); 
        ws.onopen = () => {
            statusEl.textContent = 'Conectado ao servidor';
            statusEl.className = 'status connected';
        };

        ws.onmessage = (event) => {
            const data = JSON.parse(event.data);
            const { Sensor, X = 0, Y = 0, Z = 0 } = data;

            const chart = Sensor === 'Accelerometer' ? accelerometerChart
                        : Sensor === 'Gyroscope' ? gyroscopeChart
                        : compassChart;

            const timestamp = new Date().toLocaleTimeString();
            if (chart.data.labels.length >= 20) {
                chart.data.labels.shift();
            }
            chart.data.labels.push(timestamp);

            [X, Y, Z].forEach((value, i) => {
                if (chart.data.datasets[i].data.length >= 20) {
                    chart.data.datasets[i].data.shift();
                }
                chart.data.datasets[i].data.push(value);
            });

            chart.update();

            // Atualizar o título do gráfico
            updateChartTitle(Sensor, X, Y, Z);
        };

        ws.onclose = () => {
            statusEl.textContent = 'Desconectado. Tentando reconectar...';
            statusEl.className = 'status disconnected';
            setTimeout(connectWebSocket, 5000);
        };
    }

    connectWebSocket();
</script>
